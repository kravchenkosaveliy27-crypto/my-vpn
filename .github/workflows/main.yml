name: Auto Update Every 2 Minutes

on:
  schedule:
    - cron: "*/2 * * * *"
  workflow_dispatch:

jobs:
  update:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    
    steps:
      - uses: actions/checkout@v4
      
      - name: Download and process file
        run: |
          echo "=== –ù–ê–ß–ê–õ–û –û–ë–ù–û–í–õ–ï–ù–ò–Ø ==="
          echo "üìÖ –í—Ä–µ–º—è: $(date)"
          
          # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–µ–∫—É—â–∏–π —Ñ–∞–π–ª (–µ—Å–ª–∏ –µ—Å—Ç—å)
          if [ -f my_config.txt ]; then
            echo "üìÑ –¢–µ–∫—É—â–∏–π —Ñ–∞–π–ª —Å—É—â–µ—Å—Ç–≤—É–µ—Ç. –†–∞–∑–º–µ—Ä: $(wc -l < my_config.txt) —Å—Ç—Ä–æ–∫"
            echo "–ü–µ—Ä–≤—ã–µ 3 —Å—Ç—Ä–æ–∫–∏ —Ç–µ–∫—É—â–µ–≥–æ —Ñ–∞–π–ª–∞:"
            head -3 my_config.txt
          else
            echo "üìÑ –¢–µ–∫—É—â–∏–π —Ñ–∞–π–ª –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç"
          fi
          
          # –°–∫–∞—á–∏–≤–∞–µ–º –Ω–æ–≤—ã–π —Ñ–∞–π–ª
          echo "üåê –°–∫–∞—á–∏–≤–∞—é —Å GitHub..."
          curl -s -o source.txt "https://raw.githubusercontent.com/igareck/vpn-configs-for-russia/refs/heads/main/Vless-Reality-White-Lists-Rus-Mobile.txt"
          
          # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–º–µ—Ä —Å–∫–∞—á–∞–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
          echo "üìä –°–∫–∞—á–∞–Ω–æ: $(wc -l < source.txt) —Å—Ç—Ä–æ–∫"
          echo "–ü–µ—Ä–≤—ã–µ 3 —Å—Ç—Ä–æ–∫–∏ —Å–∫–∞—á–∞–Ω–Ω–æ–≥–æ:"
          head -3 source.txt
          
          # –£–¥–∞–ª—è–µ–º –ø–µ—Ä–≤—ã–µ 2 —Å—Ç—Ä–æ–∫–∏
          echo "‚úÇÔ∏è –£–¥–∞–ª—è—é –ø–µ—Ä–≤—ã–µ 2 —Å—Ç—Ä–æ–∫–∏..."
          tail -n +3 source.txt > my_config.txt.new
          
          # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
          echo "üìä –ü–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è: $(wc -l < my_config.txt.new) —Å—Ç—Ä–æ–∫"
          echo "–ü–µ—Ä–≤—ã–µ 3 —Å—Ç—Ä–æ–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞:"
          head -3 my_config.txt.new
          
          # –°—Ä–∞–≤–Ω–∏–≤–∞–µ–º —Å —Ç–µ–∫—É—â–∏–º —Ñ–∞–π–ª–æ–º
          if [ -f my_config.txt ]; then
            if cmp -s my_config.txt my_config.txt.new; then
              echo "üì≠ –§–∞–π–ª—ã –∏–¥–µ–Ω—Ç–∏—á–Ω—ã - –∏–∑–º–µ–Ω–µ–Ω–∏–π –Ω–µ—Ç"
            else
              echo "üì¶ –§–∞–π–ª—ã –æ—Ç–ª–∏—á–∞—é—Ç—Å—è - –±—É–¥—É—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è"
              echo "–†–∞–∑–ª–∏—á–∏—è:"
              diff my_config.txt my_config.txt.new | head -10 || true
            fi
          fi
          
          # –ó–∞–º–µ–Ω—è–µ–º —Ñ–∞–π–ª
          mv my_config.txt.new my_config.txt
          rm -f source.txt
          
          echo "=== –û–ë–ù–û–í–õ–ï–ù–ò–ï –ó–ê–í–ï–†–®–ï–ù–û ==="
      
      - name: Commit and push
        run: |
          git config user.name "Auto Bot"
          git config user.email "bot@localhost"
          
          git add my_config.txt
          
          if git diff --staged --quiet; then
            echo "üì≠ –ù–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–ª—è –∫–æ–º–º–∏—Ç–∞"
          else
            echo "üì¶ –ï—Å—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è, —Å–æ–∑–¥–∞—é –∫–æ–º–º–∏—Ç..."
            git commit -m "üîÑ Update: $(date +'%Y-%m-%d %H:%M:%S')"
            git push
            echo "‚úÖ –ò–∑–º–µ–Ω–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã"
          fi
