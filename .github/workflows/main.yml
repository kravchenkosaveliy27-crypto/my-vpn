name: Auto Update Every 2 Minutes

on:
  schedule:
    - cron: "*/2 * * * *"  # –ö–∞–∂–¥—ã–µ 2 –º–∏–Ω—É—Ç—ã
  workflow_dispatch:  # –î–ª—è —Ä—É—á–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞

jobs:
  update:
    runs-on: ubuntu-latest
    
    permissions:
      contents: write  # –ü—Ä–∞–≤–æ –Ω–∞ –∑–∞–ø–∏—Å—å –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Download and process file
        run: |
          echo "==================================="
          echo "üïí –í—Ä–µ–º—è –∑–∞–ø—É—Å–∫–∞: $(date +'%Y-%m-%d %H:%M:%S')"
          echo "==================================="
          
          # URL –∏—Å—Ö–æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
          SOURCE_URL="https://raw.githubusercontent.com/igareck/vpn-configs-for-russia/refs/heads/main/Vless-Reality-White-Lists-Rus-Mobile.txt"
          
          # –ò–º—è —Ü–µ–ª–µ–≤–æ–≥–æ —Ñ–∞–π–ª–∞
          TARGET_FILE="my_config.txt"
          
          echo "üì• –°–∫–∞—á–∏–≤–∞—é —Ñ–∞–π–ª –∏–∑ –∏—Å—Ç–æ—á–Ω–∏–∫–∞..."
          
          # –°–∫–∞—á–∏–≤–∞–µ–º —Ñ–∞–π–ª
          curl -L --fail -o temp.txt "$SOURCE_URL"
          
          # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Ñ–∞–π–ª —Å–∫–∞—á–∞–ª—Å—è
          if [ ! -f temp.txt ]; then
            echo "‚ùå –û—à–∏–±–∫–∞: —Ñ–∞–π–ª –Ω–µ —Å–∫–∞—á–∞–ª—Å—è!"
            exit 1
          fi
          
          # –°—á–∏—Ç–∞–µ–º —Å—Ç—Ä–æ–∫–∏ –≤ –∏—Å—Ö–æ–¥–Ω–æ–º —Ñ–∞–π–ª–µ
          ORIGINAL_LINES=$(wc -l < temp.txt)
          echo "üìä –í –∏—Å—Ö–æ–¥–Ω–æ–º —Ñ–∞–π–ª–µ: $ORIGINAL_LINES —Å—Ç—Ä–æ–∫"
          
          # –£–¥–∞–ª—è–µ–º –ø–µ—Ä–≤—ã–µ –¥–≤–µ —Å—Ç—Ä–æ–∫–∏ –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤ —Ü–µ–ª–µ–≤–æ–π —Ñ–∞–π–ª
          echo "‚úÇÔ∏è –£–¥–∞–ª—è—é –ø–µ—Ä–≤—ã–µ 2 —Å—Ç—Ä–æ–∫–∏..."
          tail -n +3 temp.txt > "$TARGET_FILE"
          
          # –°—á–∏—Ç–∞–µ–º —Å—Ç—Ä–æ–∫–∏ –≤ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–º —Ñ–∞–π–ª–µ
          PROCESSED_LINES=$(wc -l < "$TARGET_FILE")
          echo "üìä –í –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–º —Ñ–∞–π–ª–µ: $PROCESSED_LINES —Å—Ç—Ä–æ–∫"
          
          # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–µ—Ä–≤—ã–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å—Ç—Ä–æ–∫ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
          echo "üìÑ –ü–µ—Ä–≤—ã–µ 3 —Å—Ç—Ä–æ–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞:"
          head -3 "$TARGET_FILE"
          
          echo "‚úÖ –§–∞–π–ª —É—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω!"

      - name: Commit and push changes
        run: |
          # –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º git
          git config --global user.name "Auto-Updater"
          git config --global user.email "updater@localhost"
          
          # –î–æ–±–∞–≤–ª—è–µ–º —Ñ–∞–π–ª –≤ –∫–æ–º–º–∏—Ç
          git add my_config.txt
          
          # –°–æ–∑–¥–∞–µ–º –∫–æ–º–º–∏—Ç —Å —Ç–µ–∫—É—â–µ–π –¥–∞—Ç–æ–π –∏ –≤—Ä–µ–º–µ–Ω–µ–º
          git commit -m "üîÑ –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: $(date +'%Y-%m-%d %H:%M:%S')"
          
          # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
          git push
          
          echo "==================================="
          echo "‚úÖ –ì–æ—Ç–æ–≤–æ! –§–∞–π–ª my_config.txt –æ–±–Ω–æ–≤–ª–µ–Ω"
          echo "==================================="
