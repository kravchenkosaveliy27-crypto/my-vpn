\name: Update My Config

on:
  schedule:
    - cron: "*/2 * * * *"
  workflow_dispatch:

jobs:
  update-config:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    
    steps:
      - uses: actions/checkout@v4
      
      - name: Download and process
        run: |
          # –°–∫–∞—á–∏–≤–∞–µ–º –≤–æ –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª
          curl -L --fail -o temp.txt "https://raw.githubusercontent.com/igareck/vpn-configs-for-russia/refs/heads/main/Vless-Reality-White-Lists-Rus-Mobile.txt"
          
          # –£–¥–∞–ª—è–µ–º –ø–µ—Ä–≤—ã–µ 2 —Å—Ç—Ä–æ–∫–∏
          tail -n +3 temp.txt > my_config.txt
          
          # –£–¥–∞–ª—è–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª
          rm temp.txt
          
          echo "‚úÖ –§–∞–π–ª –æ–±–Ω–æ–≤–ª–µ–Ω. –°—Ç—Ä–æ–∫: $(wc -l < my_config.txt)"
      
      - name: Push to repository
        run: |
          git config user.name "Update-Bot"
          git config user.email "bot@localhost"
          
          git add my_config.txt
          
          if git diff --staged --quiet; then
            echo "üì≠ –ù–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π"
          else
            git commit -m "üîÑ Update: $(date +'%Y-%m-%d %H:%M')"
            git push
            echo "‚úÖ –ò–∑–º–µ–Ω–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã"
          fi
